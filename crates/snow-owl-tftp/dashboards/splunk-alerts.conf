# Splunk Alert Configurations for Snow-Owl TFTP Server
# Place this file in $SPLUNK_HOME/etc/apps/snow_owl_tftp/local/savedsearches.conf

# ============================================================================
# CRITICAL SECURITY ALERTS
# ============================================================================

[TFTP Path Traversal Attempt]
description = Critical security event: Path traversal attack detected
search = index=security-audit event_type="path_traversal_attempt" \
    | stats count by client_addr, requested_path, violation_type
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 5
alert.suppress = 0
alert.track = 1
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = security-team@example.com
action.email.subject = CRITICAL: TFTP Path Traversal Attempt Detected
action.email.message.alert = Client $result.client_addr$ attempted path traversal: $result.requested_path$

[TFTP Repeated Access Denials]
description = Multiple failed access attempts from single client
search = index=security-audit event_type="read_denied" earliest=-5m \
    | stats count by client_addr, filename \
    | where count > 10 \
    | sort -count
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 4
alert.suppress = 1
alert.suppress.period = 10m
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = security-team@example.com
action.email.subject = WARNING: Repeated TFTP Access Denials
action.email.message.alert = Client $result.client_addr$ has been denied access $result.count$ times

[TFTP Write Attempt on Read-Only Server]
description = Unauthorized write attempt detected
search = index=security-audit event_type="write_request_denied" \
    | stats count by client_addr, filename, reason
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 4
alert.suppress = 0
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = security-team@example.com
action.email.subject = WARNING: Write Attempt on Read-Only TFTP Server
action.email.message.alert = Client $result.client_addr$ attempted to write $result.filename$

[TFTP Symlink Access Attempt]
description = Symlink access attempt indicating potential security probe
search = index=security-audit event_type="symlink_access_denied" \
    | stats count by client_addr, requested_path
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 5
alert.suppress = 0
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = security-team@example.com
action.email.subject = CRITICAL: TFTP Symlink Access Attempt
action.email.message.alert = Client $result.client_addr$ attempted symlink access: $result.requested_path$

# ============================================================================
# PERFORMANCE ALERTS
# ============================================================================

[TFTP High Transfer Failure Rate]
description = More than 10% of transfers failing
search = index=security-audit event_type IN ("transfer_completed", "transfer_failed") earliest=-10m \
    | stats count by event_type \
    | eventstats sum(count) as total \
    | eval failure_rate = if(event_type="transfer_failed", count/total, 0) \
    | where failure_rate > 0.1
cron_schedule = */10 * * * *
dispatch.earliest_time = -10m
dispatch.latest_time = now
enableSched = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 30m
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = WARNING: High TFTP Transfer Failure Rate
action.email.message.alert = Failure rate: $result.failure_rate$%

[TFTP Slow Transfer Speed]
description = Average transfer speed below 100 KB/s
search = index=security-audit event_type="transfer_completed" earliest=-15m \
    | stats avg(throughput_bps) as avg_throughput by filename \
    | where avg_throughput < 102400 \
    | eval avg_throughput_kbps = round(avg_throughput/1024, 2) \
    | sort -avg_throughput_kbps
cron_schedule = */15 * * * *
dispatch.earliest_time = -15m
dispatch.latest_time = now
enableSched = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 30m
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = WARNING: Slow TFTP Transfer Speeds
action.email.message.alert = File $result.filename$ averaging $result.avg_throughput_kbps$ KB/s

[TFTP Long Transfer Duration]
description = Transfers taking longer than 5 minutes
search = index=security-audit event_type="transfer_completed" earliest=-15m \
    | stats avg(duration_ms) as avg_duration by filename \
    | where avg_duration > 300000 \
    | eval avg_duration_minutes = round(avg_duration/60000, 2) \
    | sort -avg_duration_minutes
cron_schedule = */15 * * * *
dispatch.earliest_time = -15m
dispatch.latest_time = now
enableSched = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 30m
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = WARNING: Long TFTP Transfer Durations
action.email.message.alert = File $result.filename$ averaging $result.avg_duration_minutes$ minutes

# ============================================================================
# OPERATIONAL ALERTS
# ============================================================================

[TFTP Server Restart]
description = TFTP server restart detected
search = index=security-audit event_type="server_started" \
    | stats count by hostname, bind_addr, root_dir
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 2
alert.suppress = 0
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = INFO: TFTP Server Restarted
action.email.message.alert = TFTP server on $result.hostname$ restarted at $result.bind_addr$

[TFTP Configuration Error]
description = Configuration error detected
search = index=security-audit event_type="configuration_error" \
    | stats count by hostname, config_file, error
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 4
alert.suppress = 0
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = ERROR: TFTP Configuration Error
action.email.message.alert = Configuration error in $result.config_file$: $result.error$

[TFTP No Activity]
description = No TFTP activity for 30 minutes
search = index=security-audit earliest=-30m \
    | stats count \
    | where count = 0
cron_schedule = */30 * * * *
dispatch.earliest_time = -30m
dispatch.latest_time = now
enableSched = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 1h
counttype = number of events
quantity = 0
relation = equal to
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = WARNING: No TFTP Activity Detected
action.email.message.alert = No TFTP events logged in the last 30 minutes

[TFTP High Request Volume]
description = Unusually high request volume - possible DoS
search = index=security-audit event_type="read_request" earliest=-5m \
    | stats count \
    | where count > 3000
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 15m
counttype = number of events
quantity = 3000
relation = greater than
action.email = 1
action.email.to = ops-team@example.com, security-team@example.com
action.email.subject = WARNING: High TFTP Request Volume
action.email.message.alert = Received $result.count$ requests in the last 5 minutes

# ============================================================================
# COMPLIANCE ALERTS
# ============================================================================

[TFTP Daily Security Event Summary]
description = Daily summary of security events for compliance reporting
search = index=security-audit severity="error" earliest=-24h \
    | stats count by event_type, client_addr \
    | sort -count
cron_schedule = 0 8 * * *
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
alert.severity = 2
alert.suppress = 0
counttype = always
action.email = 1
action.email.to = compliance-team@example.com
action.email.subject = Daily TFTP Security Event Summary
action.email.message.alert = Security events in the last 24 hours
action.email.sendresults = 1
action.email.format = csv

[TFTP Compliance - Access Denials Report]
description = Weekly report of all access denials for audit
search = index=security-audit event_type IN ("read_denied", "write_request_denied") earliest=-7d \
    | stats count by client_addr, filename, reason \
    | sort -count
cron_schedule = 0 9 * * 1
dispatch.earliest_time = -7d
dispatch.latest_time = now
enableSched = 1
alert.severity = 1
alert.suppress = 0
counttype = always
action.email = 1
action.email.to = compliance-team@example.com
action.email.subject = Weekly TFTP Access Denials Report
action.email.message.alert = Access denials for the past week
action.email.sendresults = 1
action.email.format = csv

# ============================================================================
# MULTICAST ALERTS
# ============================================================================

[TFTP Multicast Client Timeouts]
description = High rate of multicast client timeouts
search = index=security-audit event_type="multicast_client_removed" reason="timeout" earliest=-10m \
    | stats count by session_id \
    | where count > 5
cron_schedule = */10 * * * *
dispatch.earliest_time = -10m
dispatch.latest_time = now
enableSched = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 30m
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = WARNING: High Multicast Client Timeout Rate
action.email.message.alert = Session $result.session_id$ has $result.count$ timeouts

[TFTP Large Multicast Session]
description = Large multicast session active
search = index=security-audit event_type="multicast_client_joined" earliest=-5m \
    | stats max(total_clients) as max_clients by session_id, filename \
    | where max_clients > 50
cron_schedule = */5 * * * *
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
alert.severity = 2
alert.suppress = 1
alert.suppress.period = 1h
counttype = number of events
quantity = 0
relation = greater than
action.email = 1
action.email.to = ops-team@example.com
action.email.subject = INFO: Large Multicast Session Active
action.email.message.alert = Session $result.session_id$ for $result.filename$ has $result.max_clients$ clients
