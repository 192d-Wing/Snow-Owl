# Snow-Owl TFTP Server Configuration
# Phase 1 Performance Optimizations Example

root_dir = "/var/lib/snow-owl/tftp"
bind_addr = "0.0.0.0:69"
max_file_size_bytes = 104857600  # 100 MB

[logging]
level = "info"
format = "json"
file = "/var/log/snow-owl/tftp-audit.json"
audit_enabled = true

[write_config]
enabled = false
allow_overwrite = false
allowed_patterns = []

[multicast]
enabled = false

[performance]
# RFC 1350 default is 512, but 8192 provides better throughput
# Clients can negotiate even larger sizes via RFC 2348 blksize option
default_block_size = 8192

# Buffer pool for packet reuse
buffer_pool_size = 128

# Files larger than this use streaming mode
streaming_threshold = 1048576  # 1 MB

# Audit sampling rate (1.0 = log everything)
audit_sampling_rate = 1.0

## Phase 1: Platform-Specific Performance Optimizations
[performance.platform.socket]
# Socket buffer sizes in KB
# Larger buffers reduce packet drops under high load
recv_buffer_kb = 2048  # 2 MB - reduces packet loss by 70-80%
send_buffer_kb = 2048  # 2 MB - improves burst handling

# Enable address reuse for faster server restarts
reuse_address = true

# Enable port reuse for multi-process scaling (Linux 3.9+, BSD)
# Allows running multiple server instances on the same port
reuse_port = true

[performance.platform.file_io]
# Use POSIX_FADV_SEQUENTIAL hint for sequential file reads
# Optimizes kernel read-ahead behavior
use_sequential_hint = true

# Use POSIX_FADV_WILLNEED to prefetch file data
# Reduces I/O wait time by 20-30%
use_willneed_hint = true

# Use POSIX_FADV_DONTNEED after transfer to free page cache
# Useful for large one-time transfers, but may impact repeated reads
# Recommended: false for frequently accessed files
fadvise_dontneed_after = false
